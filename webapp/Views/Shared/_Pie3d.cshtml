@using ChartsMix.Models
@using Highsoft.Web.Mvc.Charts
@model Pie3DModel
<div>
    @using (Html.BeginForm("Index", "Home", FormMethod.Post))
    {
        <div class="jarviswidget-editbox">
            <div class="widget-body">
                <div class="row">
                    <div class="col-md-6 form-group">
                        @Html.EnumDropDownListFor(m => m.period, "Period", new { @class = "form-control", @id = "ddlPie" })
                    </div>
                </div>
                <div class="row" id="divDatePie" style="display : none">
                    <div class="col-md-6 form-group">
                        @Html.EditorFor(m => m.From)
                    </div>
                    <div class="col-md-6 form-group">
                        @Html.EditorFor(m => m.To)
                    </div>
                </div>
                <div class="tree smart-form">
                    <ul>
                        @Html.Raw(Helpers.FormTreeView(Model.TreeRoot, "pie"))
                    </ul>
                </div>
            </div>
            <input type="button" class="btn btn-default" value="Show Pie Chart" id="getChartPie" onclick="GetPieChart()" />
        </div>
    }
    <div class="widget-body">
            <div id="pieChart"></div>
            @*@if (Model.Data != null)
            {
                @(Html.Highsoft().Highcharts(
                                new Highcharts
                                {
                                    Chart = new Highsoft.Web.Mvc.Charts.Chart
                                    {
                                        Options3d = new ChartOptions3d
                                        {
                                            Enabled = true,
                                            Alpha = 45,
                                            Beta = 0
                                        }
                                    },
                                    Title = new Title
                                    {
                                        Text = DateTime.Now.ToShortDateString()
                                    },
                                    Tooltip = new Tooltip
                                    {
                                        PointFormat = "{series.name}: <b>{point.percentage:.1f}%</b>"
                                    },
                                    PlotOptions = new PlotOptions
                                    {
                                        Pie = new PlotOptionsPie
                                        {
                                            AllowPointSelect = true,
                                            Cursor = PlotOptionsPieCursor.Pointer,
                                            Depth = 35,
                                            DataLabels = new PlotOptionsPieDataLabels
                                            {
                                                Enabled = true,
                                                Format = "<b>{point.name}</b>"
                                            }
                                        }
                                    },
                                    Series = new List<Series>
                                    {
                                    new PieSeries
                                    {
                                        Name = "Meters",
                                        Data = Model.Data
                                    },

                                    }
                                }
                                , "pieChart")
                )
            }*@
    </div>
</div>

<script>

    function GetPieChart() {
        var model = {};
        model.Period = $('#ddlPie').val();
        model.From = $('#From').val();
        model.To = $('#To').val();
        model.Ids = [];
        $('input[name=pieIds]:checked').each(function () {
            model.Ids.push($(this).attr('value'));
        });
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetPieChart", "Home")',
            data: model,
            dataType: "json",
            traditional: true,
            success: function (data) {
                var arr = [];
                var len = data.length;
                for (var i = 0; i < len; i++) {
                    arr.push({
                        y: data[i].Y,
                        name: data[i].Name
                    });
                }
                DreawPieChart(arr);
            },
            error: function (err) {
                alert(err);
            }
        });
    }
    function DreawPieChart(arr) {



        Highcharts.chart('pieChart', {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: 'Browser market shares January, 2015 to May, 2015'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    },
                    showInLegend: true
                }
            },
            series: [{
                name: 'Brands',
                colorByPoint: true,
                data: arr
            }]
        });


        //Highcharts.chart('pieChart', {
        //    chart: {
        //        type: 'pie'
        //    },
        //    title: {
        //        text: 'Browser market shares January, 2015 to May, 2015'
        //    },
        //    tooltip: {
        //        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        //    },
        //    plotOptions: {
        //        pie: {
        //            allowPointSelect: true,
        //            cursor: 'pointer',
        //            dataLabels: {
        //                enabled: true,
        //                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
        //                style: {
        //                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
        //                }
        //            }
        //        }
        //    },
        //    series: { data: data, name: 'meters'}
        //});
    }

</script>